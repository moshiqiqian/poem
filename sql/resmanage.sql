-- ** 完整的 SQL 数据库初始化脚本 **
-- 目标：创建 resource_db 数据库，包含 poet, poem, comment, poet_relationship 四个表，并设置外键关联。
-- 数据量已按用户要求扩充至：诗人约 20 位，诗词约 100 首。

-- 步骤 1: 创建和使用数据库
USE resource_db;

-- ----------------------------------------------------
-- 步骤 2: 创建 poet (诗人) 表 (所有子表的父表)
-- ----------------------------------------------------
DROP TABLE IF EXISTS comment;
DROP TABLE IF EXISTS poem;
DROP TABLE IF EXISTS poet_relationship;
DROP TABLE IF EXISTS poet;

CREATE TABLE poet (
    id INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '诗人ID (主键)',
    name VARCHAR(100) NOT NULL UNIQUE COMMENT '诗人姓名',
    dynasty VARCHAR(50) NOT NULL COMMENT '所属朝代',
    PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='诗人信息表';

-- 插入诗人示例数据 (扩充至 20 位)
INSERT INTO poet (name, dynasty) VALUES
('李白', '唐'),
('杜甫', '唐'),
('王维', '唐'),
('孟浩然', '唐'),
('白居易', '唐'),
('元稹', '唐'),
('苏轼', '宋'),
('辛弃疾', '宋'),
('陆游', '宋'),
('李清照', '宋'),
('欧阳修', '宋'),
('赵明诚', '宋'),
('柳宗元', '唐'),
('韩愈', '唐'),
('贾岛', '唐'),
('刘禹锡', '唐'),
('范仲淹', '宋'),
('王安石', '宋'),
('晏殊', '宋'),
('纳兰性德', '清');

-- ----------------------------------------------------
-- 步骤 3: 创建 poem (古诗) 表
-- ----------------------------------------------------
CREATE TABLE poem (
    id INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '古诗ID (主键)',
    title VARCHAR(100) NOT NULL COMMENT '古诗题目',
    content TEXT NOT NULL COMMENT '古诗内容',
    poetID INT UNSIGNED NOT NULL COMMENT '诗人ID (外键, 关联 poet 表)',
    PRIMARY KEY (id),
    CONSTRAINT fk_poetID 
        FOREIGN KEY (poetID)
        REFERENCES poet (id)
        ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='古诗内容表';

-- 插入古诗示例数据 (扩充至约 100 首)
-- 注意：poetID 必须与 poet 表中的实际 ID 对应
INSERT INTO poem (title, content, poetID) VALUES
-- 李白 (ID: 1) - 14首
('静夜思', '床前明月光，疑是地上霜。举头望明月，低头思故乡。', 1),
('望庐山瀑布', '日照香炉生紫烟，遥看瀑布挂前川。飞流直下三千尺，疑是银河落九天。', 1),
('独坐敬亭山', '众鸟高飞尽，孤云独去闲。相看两不厌，只有敬亭山。', 1),
('早发白帝城', '朝辞白帝彩云间，千里江陵一日还。两岸猿声啼不住，轻舟已过万重山。', 1),
('将进酒', '君不见，黄河之水天上来，奔流到海不复回。君不见，高堂明镜悲白发，朝如青丝暮成雪。人生得意须尽欢，莫使金樽空对月。', 1),
('侠客行', '赵客缦胡缨，吴钩霜雪明。银鞍照白马，飒沓如流星。', 1),
('月下独酌', '花间一壶酒，独酌无相亲。举杯邀明月，对影成三人。', 1),
('清平调·其一', '云想衣裳花想容，春风拂槛露华浓。若非群玉山头见，会向瑶台月下逢。', 1),
('清平调·其二', '一枝秾艳露凝香，云雨巫山枉断肠。借问汉宫谁得似？可怜飞燕倚新妆。', 1),
('清平调·其三', '名花倾国两相欢，常得君王带笑看。解释春风无限恨，沉香亭北倚阑干。', 1),
('秋浦歌·其十四', '炉火照天地，红星乱紫烟。赧郎明月夜，歌曲动寒川。', 1),
('送孟浩然之广陵', '故人西辞黄鹤楼，烟花三月下扬州。孤帆远影碧空尽，唯见长江天际流。', 1),
('黄鹤楼送孟浩然之广陵', '故人西辞黄鹤楼，烟花三月下扬州。孤帆远影碧空尽，唯见长江天际流。', 1), -- 与上一首内容相同，但题目不同，保留
('蜀道难(节选)', '噫吁嚱，危乎高哉！蜀道之难，难于上青天！', 1),

-- 杜甫 (ID: 2) - 8首
('春望', '国破山河在，城春草木深。感时花溅泪，恨别鸟惊心。', 2),
('望岳', '岱宗夫如何？齐鲁青未了。造化钟神秀，阴阳割昏晓。', 2),
('登高', '风急天高猿啸哀，渚清沙白鸟飞回。无边落木萧萧下，不尽长江滚滚来。', 2),
('茅屋为秋风所破歌', '八月秋高风怒号，卷我屋上三重茅。茅飞渡江洒江郊，高者挂罥长林梢，下者飘转沉塘坳。', 2),
('蜀相', '丞相祠堂何处寻？锦官城外柏森森。映阶碧草自春色，隔叶黄鹂空好音。', 2),
('绝句(两个黄鹂)', '两个黄鹂鸣翠柳，一行白鹭上青天。窗含西岭千秋雪，门泊东吴万里船。', 2),
('赠卫八处士', '人生不相见，动如参与商。今夕复何夕，共此灯烛光。', 2),
('兵车行', '车辚辚，马萧萧，行人弓箭各在腰。爷娘妻子走相送，尘埃不见咸阳桥。', 2),

-- 王维 (ID: 3) - 8首
('鹿柴', '空山不见人，但闻人语响。返景入深林，复照青苔上。', 3),
('鸟鸣涧', '人闲桂花落，夜静春山空。月出惊山鸟，时鸣深涧中。', 3),
('山居秋暝', '空山新雨后，天气晚来秋。明月松间照，清泉石上流。', 3),
('九月九日忆山东兄弟', '独在异乡为异客，每逢佳节倍思亲。遥知兄弟登高处，遍插茱萸少一人。', 3),
('送元二使安西', '渭城朝雨浥轻尘，客舍青青柳色新。劝君更尽一杯酒，西出阳关无故人。', 3),
('辋川闲居赠裴秀才迪', '寒山转苍翠，秋水日潺湲。倚杖柴门外，临风听暮蝉。', 3),
('竹里馆', '独坐幽篁里，弹琴复长啸。深林人不知，明月来相照。', 3),
('相思', '红豆生南国，春来发几枝。愿君多采撷，此物最相思。', 3),

-- 孟浩然 (ID: 4) - 4首
('春晓', '春眠不觉晓，处处闻啼鸟。夜来风雨声，花落知多少。', 4),
('过故人庄', '故人具鸡黍，邀我至田家。绿树村边合，青山郭外斜。', 4),
('宿建德江', '移舟泊烟渚，日暮客愁新。野旷天低树，江清月近人。', 4),
('岁暮归南山', '北阙休上书，南山归敝庐。不才明主弃，多病故人疏。', 4),

-- 白居易 (ID: 5) - 7首
('赋得古原草送别', '离离原上草，一岁一枯荣。野火烧不尽，春风吹又生。', 5),
('钱塘湖春行', '孤山寺北贾亭西，水面初平云脚低。几处早莺争暖树，谁家新燕啄春泥。', 5),
('暮江吟', '一道残阳铺水中，半江瑟瑟半江红。可怜九月初三夜，露似真珠月似弓。', 5),
('长恨歌(节选)', '天生丽质难自弃，一朝选在君王侧。回眸一笑百媚生，六宫粉黛无颜色。', 5),
('卖炭翁', '卖炭翁，伐薪烧炭南山中。满面尘灰烟火色，两鬓苍苍十指黑。', 5),
('琵琶行(节选)', '千呼万唤始出来，犹抱琵琶半遮面。转轴拨弦三两声，未成曲调先有情。', 5),
('大林寺桃花', '人间四月芳菲尽，山寺桃花始盛开。长恨春归无觅处，不知转入此中来。', 5),

-- 元稹 (ID: 6) - 4首
('遣悲怀·其二', '昔日戏言身后事，今朝都到眼前来。衣裳已施行看尽，针线犹存未忍开。', 6),
('离思五首·其四', '曾经沧海难为水，除却巫山不是云。取次花丛懒回顾，半缘修道半缘君。', 6),
('闻乐天授江州司马', '残灯无焰影幢幢，此夕闻君谪九江。垂死病中惊坐起，暗风吹雨入寒窗。', 6),
('离思五首·其一', '自爱残妆晓镜中，环钗不整待谁同。前欢已去愁难尽，犹把罗衣重一缝。', 6),

-- 苏轼 (ID: 7) - 10首
('饮湖上初晴后雨', '水光潋滟晴方好，山色空濛雨亦奇。欲把西湖比西子，淡妆浓抹总相宜。', 7),
('水调歌头·明月几时有', '明月几时有？把酒问青天。不知天上宫阙，今夕是何年。', 7),
('念奴娇·赤壁怀古', '大江东去，浪淘尽，千古风流人物。故垒西边，人道是，三国周郎赤壁。', 7),
('题西林壁', '横看成岭侧成峰，远近高低各不同。不识庐山真面目，只缘身在此山中。', 7),
('惠崇春江晚景', '竹外桃花三两枝，春江水暖鸭先知。蒌蒿满地芦芽短，正是河豚欲上时。', 7),
('定风波·莫听穿林打叶声', '莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。', 7),
('江城子·十年生死两茫茫', '十年生死两茫茫，不思量，自难忘。千里孤坟，无处话凄凉。', 7),
('和子由渑池怀旧', '人生到处知何似，应似飞鸿踏雪泥。泥上偶然留指爪，鸿飞那复计东西。', 7),
('卜算子·缺月挂疏桐', '缺月挂疏桐，漏断人初静。谁见幽人独往来，飘渺孤鸿影。', 7),
('西江月·世事一场大梦', '世事一场大梦，人生几度秋凉？夜来风叶已鸣廊。', 7),

-- 辛弃疾 (ID: 8) - 5首
('破阵子·为陈同父赋壮词以寄之', '醉里挑灯看剑，梦回吹角连营。八百里分麾下炙，五十弦翻塞外声。', 8),
('永遇乐·京口北固亭怀古', '千古江山，英雄无觅，孙仲谋处。舞榭歌台，风流总被雨打风吹去。', 8),
('丑奴儿·书博山道中壁', '少年不识愁滋味，爱上层楼。爱上层楼，为赋新词强说愁。', 8),
('青玉案·元夕', '东风夜放花千树，更吹落，星如雨。宝马雕车香满路。', 8),
('菩萨蛮·书江西造口壁', '郁孤台下清江水，中间多少行人泪。西北望长安，可怜无数山。', 8),

-- 陆游 (ID: 9) - 5首
('示儿', '死去元知万事空，但悲不见九州同。王师北定中原日，家祭无忘告乃翁。', 9),
('钗头凤', '红酥手，黄縢酒，满城春色宫墙柳。东风恶，欢情薄。', 9),
('游山西村', '莫笑农家腊酒浑，丰年留客足鸡豚。山重水复疑无路，柳暗花明又一村。', 9),
('卜算子·咏梅', '驿外断桥边，寂寞开无主。已是黄昏独自愁，更著风和雨。', 9),
('秋夜将晓出篱门迎凉有感', '三万里河东入海，五千仞岳上摩天。遗民泪尽胡尘里，南望王师又一年。', 9),

-- 李清照 (ID: 10) - 5首
('醉花阴·薄雾浓云', '薄雾浓云愁永昼，瑞脑消金兽。佳节又重阳，玉枕纱橱，半夜凉初透。', 10),
('如梦令·常记溪亭日暮', '常记溪亭日暮，沉醉不知归路。兴尽晚回舟，误入藕花深处。', 10),
('声声慢·寻寻觅觅', '寻寻觅觅，冷冷清清，凄凄惨惨戚戚。乍暖还寒时候，最难将息。', 10),
('一剪梅·红藕香残玉簟秋', '红藕香残玉簟秋。轻解罗裳，独上兰舟。云中谁寄锦书来？雁字回时，月满西楼。', 10),
('渔家傲·天接云涛连晓雾', '天接云涛连晓雾，星河欲转千帆舞。仿佛梦魂归帝所。', 10),

-- 欧阳修 (ID: 11) - 4首
('采桑子·群芳过后西湖好', '群芳过后西湖好，狼藉残红。飞雪凝妆，偏宜晴雪相映。', 11),
('蝶恋花·庭院深深深几许', '庭院深深深几许，杨柳堆烟，帘幕无重数。玉勒雕鞍游冶处，楼高不见章台路。', 11),
('醉翁亭记(节选)', '环滁皆山也。其西南诸峰，林壑尤美，望之蔚然而深秀者，琅琊也。', 11),
('戏答元珍', '春风疑不到天涯，二月山城未见花。残雪压枝犹有桔，冻雷惊笋欲抽芽。', 11),

-- 赵明诚 (ID: 12) - 0首 (专注于李清照的关联)

-- 柳宗元 (ID: 13) - 4首
('江雪', '千山鸟飞绝，万径人踪灭。孤舟蓑笠翁，独钓寒江雪。', 13),
('渔翁', '渔翁夜傍西岩宿，晓汲清湘燃楚竹。烟销日出不见人，欸乃一声山水绿。', 13),
('登柳州城楼寄漳汀封连四州', '江流曲似九回肠，扁舟欲下未为央。', 13),
('小石潭记(节选)', '从小丘西行百二十步，隔篁竹，闻水声，如鸣佩环，心乐之。', 13),

-- 韩愈 (ID: 14) - 4首
('师说(节选)', '古之学者必有师。师者，所以传道受业解惑也。', 14),
('进学解(节选)', '业精于勤，荒于嬉；行成于思，毁于随。', 14),
('晚春', '谁言寸草心，报得三春晖。', 14),
('山石', '山石荦确行径微，黄昏到寺蝙蝠飞。', 14),

-- 贾岛 (ID: 15) - 3首
('寻隐者不遇', '松下问童子，言师采药去。只在此山中，云深不知处。', 15),
('题李凝幽居', '闲居少邻并，草径入荒园。鸟宿池边树，僧敲月下门。', 15),
('剑客', '十年磨一剑，霜刃未曾试。今日把示君，谁有不平事？', 15),

-- 刘禹锡 (ID: 16) - 4首
('陋室铭', '山不在高，有仙则名。水不在深，有龙则灵。斯是陋室，惟吾德馨。', 16),
('乌衣巷', '朱雀桥边野草花，乌衣巷口夕阳斜。旧时王谢堂前燕，飞入寻常百姓家。', 16),
('望洞庭', '湖光秋月两相和，潭面无风镜未磨。遥望洞庭山水翠，白银盘里一青螺。', 16),
('竹枝词', '杨柳青青江水平，闻郎江上唱歌声。东边日出西边雨，道是无晴却有晴。', 16),

-- 范仲淹 (ID: 17) - 3首
('渔家傲·秋思', '塞下秋来风景异，衡阳雁去无留意。四面边声连角起。', 17),
('岳阳楼记(节选)', '予观夫巴陵胜状，在洞庭一湖。衔远山，吞长江，浩浩汤汤，横无际涯；朝晖夕阴，气象万千。', 17),
('苏幕遮·碧云天', '碧云天，黄叶地，秋色连波，波上寒烟翠。山映斜阳天接水，芳草无情，更在斜阳外。', 17),

-- 王安石 (ID: 18) - 4首
('泊船瓜洲', '京口瓜洲一水间，钟山只隔数重山。春风又绿江南岸，明月何时照我还。', 18),
('梅花', '墙角数枝梅，凌寒独自开。遥知不是雪，为有暗香来。', 18),
('元日', '爆竹声中一岁除，春风送暖入屠苏。千门万户曈曈日，总把新桃换旧符。', 18),
('登飞来峰', '不畏浮云遮望眼，自缘身在最高层。', 18),

-- 晏殊 (ID: 19) - 3首
('浣溪沙·一曲新词酒一杯', '一曲新词酒一杯，去年天气旧亭台。夕阳西下几时回？', 19),
('蝶恋花·槛菊愁烟兰泣露', '槛菊愁烟兰泣露。罗幕轻寒，燕子双飞去。', 19),
('踏莎行·小径红稀', '小径红稀，芳郊绿遍。高台树色阴阴见。', 19),

-- 纳兰性德 (ID: 20) - 2首
('饮水词(节选)', '人生若只如初见，何事秋风悲画扇。', 20),
('浣溪沙·谁念西风独自凉', '谁念西风独自凉，萧萧黄叶闭疏窗。沉思往事立残阳。', 20);

-- ----------------------------------------------------
-- 步骤 4: 创建 comment (评论) 表 (支持回复嵌套)
-- ----------------------------------------------------
CREATE TABLE comment (
    id INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '评论ID (主键)',
    poemID INT UNSIGNED NOT NULL COMMENT '古诗ID (外键, 关联 poem 表)',
    content TEXT NOT NULL COMMENT '评论内容',
    username VARCHAR(50) DEFAULT '匿名用户' COMMENT '评论者名称',
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '评论时间',
    parentID INT UNSIGNED NULL COMMENT '父评论ID，若为顶级评论则为NULL', 
    PRIMARY KEY (id),
    CONSTRAINT fk_comment_poemID 
        FOREIGN KEY (poemID)
        REFERENCES poem (id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_parentID 
        FOREIGN KEY (parentID)
        REFERENCES comment (id)
        ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='用户评论表';

-- 插入示例评论数据 (新增了对其他诗作的评论)
INSERT INTO comment (poemID, content, username, parentID) VALUES
(1, '这首诗意境深远，简洁有力。', 'UserA', NULL), -- ID: 1
(1, '小时候背的第一首唐诗！', 'UserB', NULL), -- ID: 2
(3, '诗圣的忧国忧民情怀，感人至深。', 'UserD', NULL), -- 新增对杜甫诗的评论
(7, '苏词豪放派的代表作之一，气势磅礴。', 'UserE', NULL), -- 新增对苏轼词的评论
(50, '“人生若只如初见”，这句太经典了。', 'UserF', NULL); -- 新增对纳兰性德的评论 (假设ID 50是纳兰性德的词)

INSERT INTO comment (poemID, content, username, parentID) VALUES
(1, 'UserC回复UserA', 'UserC', 1); -- ID: 3 (回复 ID=1 的评论)

-- ----------------------------------------------------
-- 步骤 5: 创建 poet_relationship (诗人关系) 表 (图谱边)
-- ----------------------------------------------------
CREATE TABLE poet_relationship (
    id INT AUTO_INCREMENT PRIMARY KEY,
    poetA_name VARCHAR(100) NOT NULL COMMENT '诗人A名称',
    poetB_name VARCHAR(100) NOT NULL COMMENT '诗人B名称',
    relation VARCHAR(100) NOT NULL COMMENT '关系描述 (如：挚友、师友)',
    value INT DEFAULT 1 COMMENT '关系强度/权重 (1-5，5为最强)',
    -- 外键关联诗人姓名
    FOREIGN KEY (poetA_name) REFERENCES poet(name) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (poetB_name) REFERENCES poet(name) ON DELETE CASCADE ON UPDATE CASCADE,
    UNIQUE KEY unique_relationship (poetA_name, poetB_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='诗人关系表';

-- 填充关系数据 (Links Data，已扩充)
INSERT INTO poet_relationship (poetA_name, poetB_name, relation, value) VALUES
-- 唐代核心关系
('李白', '杜甫', '挚友/互相欣赏', 5),
('白居易', '元稹', '挚友/新乐府运动', 4),
('柳宗元', '韩愈', '古文运动倡导者/挚友', 4),
-- 唐代其他关系
('王维', '孟浩然', '好友', 3),
('李白', '王维', '同代诗人/风格不同', 2),
('孟浩然', '李白', '忘年交/互相欣赏', 4),
('贾岛', '刘禹锡', '同代诗人', 2),
('刘禹锡', '白居易', '唱和诗友', 3),

-- 宋代核心关系
('苏轼', '欧阳修', '师友/文学领袖', 5),
('李清照', '赵明诚', '夫妻/金石之交', 5),
-- 宋代其他关系
('欧阳修', '苏轼', '伯乐/提携', 4),
('辛弃疾', '陆游', '爱国词人/同时代', 3),
('王安石', '苏轼', '政见不合/文学交流', 3),
('范仲淹', '欧阳修', '同僚', 3),
('晏殊', '欧阳修', '师长/提携', 3),

-- 跨朝代关联
('杜甫', '白居易', '文学继承', 2),
('纳兰性德', '李清照', '文学追慕', 1); -- 象征性地添加一个清代与宋代的关系
